<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registrar Expediente - ICAP Nacional</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background-color: #fafafa;
      font-family: 'Inter', sans-serif;
      color: #2d2d2d;
      padding: 20px;
      line-height: 1.5;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      padding: 32px;
    }
    .logo {
      width: 80px;
      display: block;
      margin: 0 auto 20px;
    }
    h1 {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      color: #2d2d2d;
      margin-bottom: 16px;
    }
    .btn-config-lists {
      background-color: #722F37;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 16px;
      display: block;
      width: fit-content;
      margin-left: auto;
    }
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #722F37;
      margin: 24px 0 16px;
      padding-bottom: 6px;
      border-bottom: 2px solid #f0f0f0;
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin-bottom: 20px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    label {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #333;
    }
    input, select, textarea {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 15px;
      background-color: #fdfdfd;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #722F37;
      box-shadow: 0 0 0 3px rgba(114, 47, 55, 0.1);
    }
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    .btn-save {
      background-color: #722F37;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s ease;
      display: block;
      width: 100%;
      max-width: 220px;
    }
    .btn-save:hover {
      background-color: #5e262d;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(114, 47, 55, 0.2);
    }
    .back-link {
      display: inline-block;
      margin-top: 10px;
      color: #722F37;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
    }
    .back-link:hover {
      text-decoration: underline;
    }

    /* Panel de gestión de listas */
    #configModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }
    .config-content {
      background: white;
      margin: 50px auto;
      padding: 24px;
      width: 90%;
      max-width: 600px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    .config-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .config-header h2 {
      color: #722F37;
    }
    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
    }
    .config-section {
      margin-bottom: 20px;
    }
    .config-section h3 {
      margin-bottom: 10px;
      font-size: 16px;
      color: #333;
    }
    .option-list {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      min-height: 60px;
    }
    .option-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      font-size: 14px;
    }
    .add-option {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    .add-option input {
      flex: 1;
    }
    .add-option button {
      padding: 6px 12px;
      background: #722F37;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <img 
      src="https://raw.githubusercontent.com/icapnacional/sistema-expedientes/main/Logo.png" 
      alt="ICAP Nacional - PNB" 
      class="logo"
    />
    <h1>Registrar Nuevo Expediente</h1>

    <!-- Botón para gestionar listas -->
    <button class="btn-config-lists" onclick="openConfigModal()">⚙️ Gestionar Listas</button>

    <!-- Sección: Datos Personales -->
    <h2 class="section-title">Datos Personales</h2>
    <div class="form-row">
      <div class="form-group">
        <label for="foto">Foto (URL)</label>
        <input type="text" id="foto" placeholder="URL de la foto">
      </div>
      <div class="form-group">
        <label for="nombre">Nombre</label>
        <input type="text" id="nombre" required>
      </div>
      <div class="form-group">
        <label for="apellido">Apellido</label>
        <input type="text" id="apellido" required>
      </div>
      <div class="form-group">
        <label for="fechaNac">Fecha de Nacimiento</label>
        <input type="date" id="fechaNac">
      </div>
      <div class="form-group">
        <label for="cedula">Cédula de Identidad</label>
        <input type="text" id="cedula" placeholder="V-12345678">
      </div>
      <div class="form-group">
        <label for="sexo">Sexo</label>
        <select id="sexo">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="edad">Edad</label>
        <input type="number" id="edad" min="18" max="100">
      </div>
      <div class="form-group">
        <label for="jerarquia">Jerarquía</label>
        <select id="jerarquia">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="estatusPersonal">Estatus</label>
        <select id="estatusPersonal">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="telefono">Teléfono</label>
        <input type="tel" id="telefono" placeholder="0412-1234567">
      </div>
      <div class="form-group">
        <label for="correo">Correo</label>
        <input type="email" id="correo">
      </div>
      <div class="form-group">
        <label for="direccion">Dirección</label>
        <textarea id="direccion" placeholder="Dirección completa"></textarea>
      </div>
    </div>

    <!-- Sección: Expediente -->
    <h2 class="section-title">Expediente</h2>
    <div class="form-row">
      <div class="form-group">
        <label for="tipoExpediente">Tipo de Expediente</label>
        <select id="tipoExpediente">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="icapOficina">ICAP (Oficina)</label>
        <select id="icapOficina">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="funcInvestigado">Funcionario Investigado</label>
        <select id="funcInvestigado">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="condicionFunc">Condición del Funcionario en el Caso</label>
        <select id="condicionFunc">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="denunciante">Denunciante</label>
        <select id="denunciante">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="origenFalta">Origen de la Falta</label>
        <select id="origenFalta">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="tipoFalta">Tipo de Falta</label>
        <select id="tipoFalta">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="faltaArt">Falta (Artículo)</label>
        <select id="faltaArt">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="estatusExpediente">Estatus</label>
        <select id="estatusExpediente">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="decision">Decisión</label>
        <select id="decision">
          <option value="">Cargando...</option>
        </select>
      </div>
    </div>

    <!-- Campos de texto libre -->
    <div class="form-group">
      <label for="resena">Reseña del Caso</label>
      <textarea id="resena" placeholder="Descripción detallada del caso..."></textarea>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="servicioLabora">Servicio donde Labora</label>
        <input type="text" id="servicioLabora">
      </div>
      <div class="form-group">
        <label for="expedientePenalAnio">Expediente Penal Año</label>
        <input type="number" id="expedientePenalAnio" min="1900" max="2099">
      </div>
      <div class="form-group">
        <label for="fechaInicio">Fecha de Inicio</label>
        <input type="date" id="fechaInicio">
      </div>
      <div class="form-group">
        <label for="expedienteNumero">Expediente Número</label>
        <input type="text" id="expedienteNumero" placeholder="Ej: EXP-2024-1234">
      </div>
      <div class="form-group">
        <label for="causa">Causa</label>
        <input type="text" id="causa">
      </div>
      <div class="form-group">
        <label for="funcDetenido">¿Funcionario Detenido?</label>
        <select id="funcDetenido">
          <option value="">Cargando...</option>
        </select>
      </div>
      <div class="form-group">
        <label for="sustanciador">Sustanciador Remisión</label>
        <input type="text" id="sustanciador">
      </div>
      <div class="form-group">
        <label for="registradoPor">Registrado Por</label>
        <input type="text" id="registradoPor">
      </div>
    </div>

    <button class="btn-save">Guardar Expediente</button>
    <a href="index.html" class="back-link">← Volver al Panel</a>
  </div>

  <!-- Modal de configuración -->
  <div id="configModal">
    <div class="config-content">
      <div class="config-header">
        <h2>Gestionar Listas</h2>
        <button class="close-btn" onclick="closeConfigModal()">×</button>
      </div>
      <div class="config-section">
        <h3>Jerarquías</h3>
        <div class="option-list" id="jerarquiaList"></div>
        <div class="add-option">
          <input type="text" id="newJerarquia" placeholder="Nueva jerarquía">
          <button onclick="addOption('jerarquias', 'newJerarquia', 'jerarquiaList')">+</button>
        </div>
      </div>
      <div class="config-section">
        <h3>Tipos de Falta</h3>
        <div class="option-list" id="tipoFaltaList"></div>
        <div class="add-option">
          <input type="text" id="newTipoFalta" placeholder="Nuevo tipo">
          <button onclick="addOption('tipos_falta', 'newTipoFalta', 'tipoFaltaList')">+</button>
        </div>
      </div>
      <div class="config-section">
        <h3>Faltas (Artículos)</h3>
        <div class="option-list" id="faltaArtList"></div>
        <div class="add-option">
          <input type="text" id="newFaltaArt" placeholder="Ej: Art. 49 – ...">
          <button onclick="addOption('faltas_art', 'newFaltaArt', 'faltaArtList')">+</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Configuración inicial de listas
    const defaultLists = {
      sexos: [
        { label: 'Masculino', value: 'masculino' },
        { label: 'Femenino', value: 'femenino' },
        { label: 'Otro', value: 'otro' }
      ],
      estatus_personales: [
        { label: 'Activo', value: 'activo' },
        { label: 'Suspendido', value: 'suspendido' },
        { label: 'Baja', value: 'baja' }
      ],
      tipos_expediente: [
        { label: 'Disciplinario', value: 'disciplinario' },
        { label: 'Administrativo', value: 'administrativo' },
        { label: 'Penal', value: 'penal' }
      ],
      icap_oficinas: [
        { label: 'Caracas', value: 'caracas' },
        { label: 'Maracay', value: 'maracay' },
        { label: 'Valencia', value: 'valencia' }
      ],
      func_investigados: [
        { label: 'Capitán Juan Pérez', value: 'cap_juan' },
        { label: 'Teniente María López', value: 'ten_maria' },
        { label: 'Sargento Carlos Rojas', value: 'sarg_carlos' }
      ],
      condiciones_func: [
        { label: 'Imputado', value: 'imputado' },
        { label: 'Testigo', value: 'testigo' },
        { label: 'Denunciado', value: 'denunciado' }
      ],
      denunciantes: [
        { label: 'Ciudadano Anónimo', value: 'ciudadano' },
        { label: 'Oficial Superior', value: 'superior' },
        { label: 'Otro Funcionario', value: 'otro_func' },
        { label: 'Institución Pública', value: 'institucion' }
      ],
      origenes_falta: [
        { label: 'Interna', value: 'interna' },
        { label: 'Externa', value: 'externa' }
      ],
      tipos_falta: [
        { label: 'Leve', value: 'leve' },
        { label: 'Grave', value: 'grave' },
        { label: 'Muy Grave', value: 'muy_grave' }
      ],
      faltas_art: [
        { label: 'Art. 45 – Abandono de cargo', value: 'art45' },
        { label: 'Art. 46 – Insubordinación', value: 'art46' },
        { label: 'Art. 47 – Uso indebido de uniforme', value: 'art47' },
        { label: 'Art. 48 – Conducta inmoral', value: 'art48' }
      ],
      estatus_expedientes: [
        { label: 'Abierto', value: 'abierto' },
        { label: 'Cerrado', value: 'cerrado' },
        { label: 'Archivado', value: 'archivado' }
      ],
      decisiones: [
        { label: 'Sanción Administrativa', value: 'sancion' },
        { label: 'Absolución', value: 'absolucion' },
        { label: 'Remisión a Fiscalía', value: 'remision' },
        { label: 'Archivo del caso', value: 'archivo' }
      ],
      func_detenidos: [
        { label: 'Sí', value: 'si' },
        { label: 'No', value: 'no' }
      ],
      jerarquias: [
        { label: 'Comisario General', value: 'comisario_general' },
        { label: 'Comisario Jefe', value: 'comisario_jefe' },
        { label: 'Comisario', value: 'comisario' },
        { label: 'Subcomisario', value: 'subcomisario' },
        { label: 'Inspector Jefe', value: 'inspector_jefe' },
        { label: 'Inspector', value: 'inspector' },
        { label: 'Subinspector', value: 'subinspector' },
        { label: 'Oficial Jefe', value: 'oficial_jefe' },
        { label: 'Oficial', value: 'oficial' },
        { label: 'Oficial Ayudante', value: 'oficial_ayudante' },
        { label: 'Sargento', value: 'sargento' },
        { label: 'Cabo', value: 'cabo' },
        { label: 'Policía', value: 'policia' }
      ]
    };

    // Cargar listas desde localStorage o usar valores por defecto
    function loadLists() {
      const saved = localStorage.getItem('dropdownLists');
      return saved ? JSON.parse(saved) : defaultLists;
    }

    // Guardar listas en localStorage
    function saveLists(lists) {
      localStorage.setItem('dropdownLists', JSON.stringify(lists));
    }

    // Rellenar un select
    function populateSelect(selectId, options) {
      const select = document.getElementById(selectId);
      select.innerHTML = '<option value="">Seleccionar</option>';
      options.forEach(opt => {
        const option = document.createElement('option');
        option.value = opt.value;
        option.textContent = opt.label;
        select.appendChild(option);
      });
    }

    // Mostrar lista en el modal
    function renderList(listKey, containerId) {
      const lists = loadLists();
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      lists[listKey].forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'option-item';
        div.innerHTML = `
          ${item.label}
          <button onclick="removeOption('${listKey}', ${index})" style="background:none;border:none;color:#c00;cursor:pointer;">🗑️</button>
        `;
        container.appendChild(div);
      });
    }

    // Agregar opción
    function addOption(listKey, inputId, containerId) {
      const input = document.getElementById(inputId);
      const value = input.value.trim();
      if (!value) return;
      
      const lists = loadLists();
      const newOption = { label: value, value: value.toLowerCase().replace(/\s+/g, '_') };
      lists[listKey].push(newOption);
      saveLists(lists);
      
      input.value = '';
      renderList(listKey, containerId);
      populateSelectFromList(listKey);
    }

    // Eliminar opción
    function removeOption(listKey, index) {
      const lists = loadLists();
      lists[listKey].splice(index, 1);
      saveLists(lists);
      renderList(listKey, `jerarquiaList`.replace('jerarquiaList', 
        listKey === 'jerarquias' ? 'jerarquiaList' :
        listKey === 'tipos_falta' ? 'tipoFaltaList' : 'faltaArtList'
      ));
      populateSelectFromList(listKey);
    }

    // Rellenar selects desde localStorage
    function populateSelectFromList(listKey) {
      const lists = loadLists();
      if (listKey === 'jerarquias') populateSelect('jerarquia', lists.jerarquias);
      if (listKey === 'tipos_falta') populateSelect('tipoFalta', lists.tipos_falta);
      if (listKey === 'faltas_art') populateSelect('faltaArt', lists.faltas_art);
    }

    // Inicializar todo
    function init() {
      const lists = loadLists();
      populateSelect('sexo', lists.sexos);
      populateSelect('estatusPersonal', lists.estatus_personales);
      populateSelect('tipoExpediente', lists.tipos_expediente);
      populateSelect('icapOficina', lists.icap_oficinas);
      populateSelect('funcInvestigado', lists.func_investigados);
      populateSelect('condicionFunc', lists.condiciones_func);
      populateSelect('denunciante', lists.denunciantes);
      populateSelect('origenFalta', lists.origenes_falta);
      populateSelect('tipoFalta', lists.tipos_falta);
      populateSelect('faltaArt', lists.faltas_art);
      populateSelect('estatusExpediente', lists.estatus_expedientes);
      populateSelect('decision', lists.decisiones);
      populateSelect('funcDetenido', lists.func_detenidos);
      populateSelect('jerarquia', lists.jerarquias);
    }

    // Modal
    function openConfigModal() {
      document.getElementById('configModal').style.display = 'block';
      renderList('jerarquias', 'jerarquiaList');
      renderList('tipos_falta', 'tipoFaltaList');
      renderList('faltas_art', 'faltaArtList');
    }
    function closeConfigModal() {
      document.getElementById('configModal').style.display = 'none';
    }

    // Guardar (pendiente)
    document.querySelector('.btn-save').addEventListener('click', () => {
      alert('Funcionalidad de guardado pendiente.');
    });

    // Iniciar
    init();
  </script>
</body>
</html>
